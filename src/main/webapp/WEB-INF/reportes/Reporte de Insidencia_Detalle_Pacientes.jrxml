<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="Reporte de Insidencia_Detalle_Pacientes" pageWidth="500" pageHeight="700" columnWidth="500" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" uuid="fbc77641-cc2f-4439-9d2a-eaed38c69110">
	<property name="ireport.zoom" value="1.5"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="idDepartamento" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="fDesde" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="fHasta" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT sic_persona.nombre,sic_persona.apellido,sic_paciente.id_sic_paciente,sic_paciente.fk_sic_contacto_paciente,sic_paciente.fx_creacion,
    sic_paciente.numero_expediente,sic_paciente.telefono_paciente,sic_paciente.dui_paciente,sic_paciente.direccion_paciente,
    date_part('year',age(sic_paciente.fx_nacimiento)) as edad, sic_paciente.fx_creacion,sic_paciente.fx_nacimiento,
       sic_pais.nombre_pais,sic_departamento.nombre_departamento,sic_municipio.nombre_municipio,
       sic_contacto_paciente.nombre_contacto,sic_contacto_paciente.apellido_contacto,
       sic_contacto_paciente.telefono,sic_estado_paciente.descripcion
  FROM sic_paciente
  inner join sic_persona on (sic_paciente.fk_sic_persona=sic_persona.id_sic_persona)
  inner join sic_estado_paciente on(fk_sic_estado_paciente=sic_estado_paciente.id_sic_estado_paciente)
  inner join sic_municipio on(sic_paciente.fk_sic_municipio=sic_municipio.id_sic_municipio)
  inner join sic_departamento on (sic_municipio.fk_sic_departamento=sic_departamento.id_sic_departamento)
  inner join sic_pais on (sic_departamento.fk_sic_pais=sic_pais.id_sic_pais)
  left outer join sic_contacto_paciente on(sic_paciente.fk_sic_contacto_paciente=sic_contacto_paciente.id_sic_contacto_paciente)
  where
	sic_paciente.fx_creacion>=$P{fDesde} and sic_paciente.fx_creacion<=$P{fHasta}
 and sic_departamento.id_sic_departamento=$P{idDepartamento}
group by sic_paciente.id_sic_paciente,sic_municipio.id_sic_municipio,sic_persona.nombre,sic_persona.apellido,sic_pais.nombre_pais,
sic_departamento.nombre_departamento,sic_municipio.nombre_municipio,sic_contacto_paciente.nombre_contacto,sic_contacto_paciente.apellido_contacto,
sic_contacto_paciente.telefono,sic_estado_paciente.descripcion
order by sic_municipio.nombre_municipio,sic_persona.nombre,sic_persona.apellido;]]>
	</queryString>
	<field name="nombre" class="java.lang.String"/>
	<field name="apellido" class="java.lang.String"/>
	<field name="id_sic_paciente" class="java.lang.Integer"/>
	<field name="fk_sic_contacto_paciente" class="java.lang.Integer"/>
	<field name="fx_creacion" class="java.sql.Timestamp"/>
	<field name="numero_expediente" class="java.lang.String"/>
	<field name="telefono_paciente" class="java.lang.String"/>
	<field name="dui_paciente" class="java.lang.String"/>
	<field name="direccion_paciente" class="java.lang.String"/>
	<field name="edad" class="java.lang.Double"/>
	<field name="fx_nacimiento" class="java.sql.Date"/>
	<field name="nombre_pais" class="java.lang.String"/>
	<field name="nombre_departamento" class="java.lang.String"/>
	<field name="nombre_municipio" class="java.lang.String"/>
	<field name="nombre_contacto" class="java.lang.String"/>
	<field name="apellido_contacto" class="java.lang.String"/>
	<field name="telefono" class="java.lang.String"/>
	<field name="descripcion" class="java.lang.String"/>
	<variable name="Municipio" class="java.lang.String" resetType="Group" resetGroup="Municipio">
		<variableExpression><![CDATA[$F{nombre_municipio}.toUpperCase()]]></variableExpression>
		<initialValueExpression><![CDATA[$F{nombre_municipio}.toUpperCase()]]></initialValueExpression>
	</variable>
	<variable name="NombrePaciente" class="java.lang.String">
		<variableExpression><![CDATA[$F{nombre}.toUpperCase()+", "+$F{apellido}.toUpperCase()]]></variableExpression>
	</variable>
	<variable name="TelefonoPaciente" class="java.lang.String">
		<variableExpression><![CDATA[(!$F{telefono_paciente}.equals("") ?$F{telefono_paciente} :" " )]]></variableExpression>
	</variable>
	<variable name="DireccionPaciente" class="java.lang.String">
		<variableExpression><![CDATA[$F{nombre_municipio}+", "+$F{nombre_departamento}+", "+$F{nombre_pais}]]></variableExpression>
	</variable>
	<group name="Municipio">
		<groupExpression><![CDATA[$F{nombre_municipio}]]></groupExpression>
		<groupHeader>
			<band height="20">
				<textField>
					<reportElement x="0" y="0" width="500" height="20" uuid="59c32af8-4c8a-4aa5-96f8-0d87a5cb9d94"/>
					<textElement>
						<font size="12" isBold="true" isUnderline="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$V{Municipio}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="2" splitType="Stretch"/>
	</title>
	<pageHeader>
		<band height="3" splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="5" splitType="Stretch"/>
	</columnHeader>
	<detail>
		<band height="81" splitType="Stretch">
			<textField>
				<reportElement x="25" y="1" width="475" height="20" uuid="96d72a2b-08a0-46de-8ca6-f9479fbb6b5c"/>
				<textElement>
					<font isBold="true" isUnderline="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{NombrePaciente}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="40" y="21" width="58" height="20" uuid="9460ac97-a5f6-4f43-b082-dc30a519e501"/>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Expediente:]]></text>
			</staticText>
			<staticText>
				<reportElement x="194" y="21" width="65" height="20" uuid="031c3e18-18c2-4f4b-8501-1a062cd20996"/>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Doc. Identidad:]]></text>
			</staticText>
			<staticText>
				<reportElement x="40" y="41" width="47" height="20" uuid="4f298148-8295-4888-8040-57fe1646cb6b"/>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Tel/Cel:]]></text>
			</staticText>
			<textField>
				<reportElement x="98" y="21" width="83" height="20" uuid="91e77f58-92fa-4179-b400-8329d0f47289"/>
				<textElement verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{numero_expediente}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="87" y="41" width="413" height="20" uuid="359eaf5e-a96b-4794-b435-7d564dba4122"/>
				<textElement verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{TelefonoPaciente}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="40" y="61" width="79" height="20" uuid="776132de-1ba8-4886-a6b5-28c5f428af26"/>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Fecha Integración:]]></text>
			</staticText>
			<staticText>
				<reportElement x="361" y="21" width="38" height="20" uuid="efd10501-338e-4710-8635-894277f8e339"/>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Estado:]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy">
				<reportElement x="119" y="61" width="67" height="20" uuid="30b7b23f-1522-465f-8389-cc9f30055195"/>
				<textElement verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{fx_creacion}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="400" y="21" width="84" height="20" uuid="4f99b078-6e16-412f-acc2-40adc0cdb045"/>
				<textElement verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{descripcion}]]></textFieldExpression>
			</textField>
			<subreport>
				<reportElement x="258" y="21" width="103" height="20" uuid="566e1e1b-977c-4011-94e3-071cd394c3f6"/>
				<subreportParameter name="id_paciente">
					<subreportParameterExpression><![CDATA[$F{id_sic_paciente}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA["reporte_documento_identidad.jasper"]]></subreportExpression>
			</subreport>
		</band>
		<band height="20">
			<printWhenExpression><![CDATA[$F{fx_nacimiento}!=null]]></printWhenExpression>
			<staticText>
				<reportElement x="40" y="0" width="77" height="20" uuid="05336056-2d2c-4a91-a20f-b1c2ddaed21a"/>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Fecha Nacimiento:]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy">
				<reportElement x="117" y="0" width="73" height="20" uuid="d42ee6a9-6c3b-4948-8878-50cd3c0baa6d"/>
				<textElement verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{fx_nacimiento}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="194" y="0" width="53" height="20" uuid="d6941716-4375-4a5d-9619-e3d42e557d2c"/>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Edad(Años):]]></text>
			</staticText>
			<textField pattern="###0">
				<reportElement x="247" y="0" width="70" height="20" uuid="eee419f2-d853-4f6b-9cce-527b26455045"/>
				<textElement verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{edad}]]></textFieldExpression>
			</textField>
		</band>
		<band height="40">
			<printWhenExpression><![CDATA[$F{direccion_paciente}!=null]]></printWhenExpression>
			<staticText>
				<reportElement x="40" y="0" width="57" height="20" uuid="bb832ef2-8c83-430c-b43c-600b3891c1a9"/>
				<textElement>
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Dirección:]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement x="97" y="20" width="402" height="18" uuid="0b98887e-7b12-4363-b644-81c08fc5d77c"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{DireccionPaciente}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="97" y="0" width="402" height="20" uuid="465b49a0-4aa0-4382-b20b-3fce7571faf4"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{direccion_paciente}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band splitType="Stretch"/>
	</pageFooter>
	<summary>
		<band height="5" splitType="Stretch"/>
	</summary>
</jasperReport>
